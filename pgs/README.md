# PGS toolset

More on PGS: https://choishingwan.github.io/PRS-Tutorial/

## Codes

- ``README.md``: this file
- ``pgs/pgs.py``: Python class definitions setup to create bash commands for different PGS tools (``plink``, ``PRSice2``, ``LDpred2``, etc.)
- ``run_pgs_synthetic.py``: Python run script setup to run PGS tools on synthetic datas provided in this repository, mainly for testing purposes.
- ``run_pgs_w_QC.py``: Python run script setup to run PGS tools on datas provided in this repository, mainly for testing purposes. Performs basic QC steps.
- ``pgs_exec.py``: ``gwas.py`` like command line tool that can be used to run, create bash and slurm job scripts for different PGS tools. 
- ``*.R``: misc. ``R`` scripts defining or being used by the PGS tools or optional QC steps. 
- ``vis_pgs_synthetic.ipynb``: Jupyter notebook plotting/comparing the output PGS scores generated by the ``run_pgs_synthetic.py`` script.
- ``vis_pgs_w_QC.ipynb``: Jupyter notebook plotting/comparing the output PGS scores generated by the ``run_pgs_w_QC.py`` script.
- ``start_jupyter_server.py``: start a Jupyter server using the ``python3.sif`` container (allows jupyter notebooks within VSCode with the Jupyter extension)
- ``config.yaml``: YAML file defining some parameters for Slurm jobscripts and PGS methods

## Requirements

Prerequisites for using these files

## Running the codes

(subject to change)

### Python runtime scripts
```
$ python3 run_pgs_w_QC.py
```

> **_NOTE:_**  The script may require other packages than Python builtins, such as ``pandas`` and ``pyyaml``. Install these by issuing ``pip install <package>`` in the current Python environment.


### ``pgs_exec.py`` command line tool 

Run, create bash and slurm job scripts for different PGS tools

Get a list of options:
```
$ python3 pgs_exec.py --help
usage: PGS [-h] [--Sumstats_file SUMSTATS_FILE] [--Pheno_file PHENO_FILE] [--Input_dir INPUT_DIR] [--Data_prefix DATA_PREFIX] [--Data_postfix DATA_POSTFIX]
           [--Output_dir OUTPUT_DIR] [--method {plink,prsice2,ldpred2-inf,ldpred2-auto}] [--runtype {sh,slurm,subprocess}] [--Cov_file COV_FILE] [--Eigenvec-file EIGENVEC_FILE]
           [--keep_SNPs_file KEEP_SNPS_FILE]

A pipeline for PGS analysis

optional arguments:
  -h, --help            show this help message and exit
  --Sumstats_file SUMSTATS_FILE
                        summary statistics file
  --Pheno_file PHENO_FILE
                        Phenotype file
  ...
  --keep_SNPs_file KEEP_SNPS_FILE
                        File with RSIDs of SNPs to keep (for method=[ldpred2-inf, ldpred2-auto])
```

Example w. PRSice2 as subprocess on synthetic dataset (``pgs_exec_example_1.sh``):
```
python3 pgs_exec.py \
    --Sumstats_file '/REF/examples/ldpred2/trait1.sumstats.gz' \
    --Pheno_file '/REF/examples/ldpred2/simu.pheno' \
    --Input_dir '/REF/examples/ldpred2' \
    --Data_prefix 'g1000_eur_chr21to22_hm3rnd1' \
    --Output_dir 'PGS_synthetic_prsice2' \
    --method prsice2 \
    --runtype 'subprocess' \
    --Cov_file '/REF/examples/prsice2/EUR.cov' \
    --Eigenvec-file 'g1000_eur_chr21to22_hm3rnd1.eigenvec' \
    stat 'BETA' \
    beta ''
```
> **_NOTE:_**  The last two lines will override settings for ``method: prsice2`` in ``config.yaml`` file, being parsed to the ``PRSice2.r`` script

